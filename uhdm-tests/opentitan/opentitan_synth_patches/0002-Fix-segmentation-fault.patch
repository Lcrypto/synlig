From f304f8bbae7f6cb256247e903859e5d4dc86c2d7 Mon Sep 17 00:00:00 2001
From: Kamil Rakoczy <krakoczy@antmicro.com>
Date: Tue, 14 Mar 2023 11:02:31 +0100
Subject: [PATCH 02/18] Fix segmentation fault

Signed-off-by: Kamil Rakoczy <krakoczy@antmicro.com>
---
 hw/ip/otp_ctrl/rtl/otp_ctrl.sv          | 1 +
 hw/ip/otp_ctrl/rtl/otp_ctrl_part_buf.sv | 3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/hw/ip/otp_ctrl/rtl/otp_ctrl.sv b/hw/ip/otp_ctrl/rtl/otp_ctrl.sv
index dcc4a7eab..7ad953365 100644
--- a/hw/ip/otp_ctrl/rtl/otp_ctrl.sv
+++ b/hw/ip/otp_ctrl/rtl/otp_ctrl.sv
@@ -1160,6 +1160,7 @@ module otp_ctrl
     end else if (PartInfo[k].variant == Buffered) begin : gen_buffered
       otp_ctrl_part_buf #(
         .Info(PartInfo[k]),
+        .InfoSize(PartInfo[k].size),
         .DataDefault(PartInvDefault[PartInfo[k].offset*8 +: PartInfo[k].size*8])
       ) u_part_buf (
         .clk_i,
diff --git a/hw/ip/otp_ctrl/rtl/otp_ctrl_part_buf.sv b/hw/ip/otp_ctrl/rtl/otp_ctrl_part_buf.sv
index 7806a9d96..3df71715d 100644
--- a/hw/ip/otp_ctrl/rtl/otp_ctrl_part_buf.sv
+++ b/hw/ip/otp_ctrl/rtl/otp_ctrl_part_buf.sv
@@ -14,7 +14,8 @@ module otp_ctrl_part_buf
 #(
   // Partition information.
   parameter part_info_t             Info = PartInfoDefault,
-  parameter logic [Info.size*8-1:0] DataDefault = '0
+  parameter int InfoSize = 8,
+  parameter logic [InfoSize*8-1:0] DataDefault = '0
 ) (
   input                               clk_i,
   input                               rst_ni,
-- 
2.39.0

