From 20d4e309cf0a3f61bf1f029815994a6bca914e27 Mon Sep 17 00:00:00 2001
From: Kamil Rakoczy <krakoczy@antmicro.com>
Date: Tue, 14 Mar 2023 15:07:07 +0100
Subject: [PATCH 10/18] Don't use assignment pattern inside assignment pattern

Signed-off-by: Kamil Rakoczy <krakoczy@antmicro.com>
---
 hw/ip/otbn/rtl/otbn_loop_controller.sv        |  7 ++--
 .../flash_ctrl/rtl/autogen/flash_ctrl_pkg.sv  | 19 ++--------
 .../autogen/chip_custom_tiny_nexysvideo.sv    | 36 +++++++++++--------
 3 files changed, 27 insertions(+), 35 deletions(-)

diff --git a/hw/ip/otbn/rtl/otbn_loop_controller.sv b/hw/ip/otbn/rtl/otbn_loop_controller.sv
index 481de5581..146d3ee62 100644
--- a/hw/ip/otbn/rtl/otbn_loop_controller.sv
+++ b/hw/ip/otbn/rtl/otbn_loop_controller.sv
@@ -130,12 +130,13 @@ module otbn_loop_controller
   logic unused_new_loop_addrs_padded_intg;
   assign unused_new_loop_addrs_padded_intg = ^new_loop_addrs_padded_intg[31:0];
 
-  assign new_loop = '{
-    loop_addr_info : '{
+  loop_addr_info_t loop_addr_info = '{
         loop_start:      next_insn_addr_i,
         loop_end:        new_loop_end_addr_imem,
         loop_addrs_intg: new_loop_addrs_padded_intg[38:32]
-    },
+    };
+  assign new_loop = '{
+    loop_addr_info : loop_addr_info,
     loop_iterations: loop_iterations_i
   };
 
diff --git a/hw/top_custom_tiny/ip/flash_ctrl/rtl/autogen/flash_ctrl_pkg.sv b/hw/top_custom_tiny/ip/flash_ctrl/rtl/autogen/flash_ctrl_pkg.sv
index 94825c267..6c6b87908 100644
--- a/hw/top_custom_tiny/ip/flash_ctrl/rtl/autogen/flash_ctrl_pkg.sv
+++ b/hw/top_custom_tiny/ip/flash_ctrl/rtl/autogen/flash_ctrl_pkg.sv
@@ -296,22 +296,7 @@ package flash_ctrl_pkg;
      }
   };
 
-  parameter data_region_attr_t HwDataAttr[HwDataRules] = '{
-    '{
-       phase: PhaseRma,
-       cfg:   '{
-                 en:          MuBi4True,
-                 rd_en:       MuBi4True,
-                 prog_en:     MuBi4True,
-                 erase_en:    MuBi4True,
-                 scramble_en: MuBi4True,
-                 ecc_en:      MuBi4True,
-                 he_en:       MuBi4True, // HW assumes high endurance
-                 base:        '0,
-                 size:        NumBanks * PagesPerBank
-                }
-     }
-  };
+  parameter data_region_attr_t HwDataAttr = 49'b0101100110011001100110011001100000000001000000000;
 
 
   ////////////////////////////
@@ -389,7 +374,7 @@ package flash_ctrl_pkg;
     logic [BusFullWidth-1:0] prog_data;
     logic                 prog_last;
     flash_prog_e          prog_type;
-    mp_region_cfg_t [MpRegions:0] region_cfgs;
+    logic [375:0] region_cfgs;
     logic [KeyWidth-1:0]  addr_key;
     logic [KeyWidth-1:0]  data_key;
     logic [KeyWidth-1:0]  rand_addr_key;
diff --git a/hw/top_custom_tiny/rtl/autogen/chip_custom_tiny_nexysvideo.sv b/hw/top_custom_tiny/rtl/autogen/chip_custom_tiny_nexysvideo.sv
index 4233b44e6..63f91e9ee 100644
--- a/hw/top_custom_tiny/rtl/autogen/chip_custom_tiny_nexysvideo.sv
+++ b/hw/top_custom_tiny/rtl/autogen/chip_custom_tiny_nexysvideo.sv
@@ -524,35 +524,41 @@ module chip_custom_tiny_nexysvideo #(
   prim_ram_2p_pkg::ram_2p_cfg_t ram_2p_cfg;
   prim_rom_pkg::rom_cfg_t rom_cfg;
 
-  // conversion from ast structure to memory centric structures
-  assign ram_1p_cfg = '{
-    ram_cfg: '{
+  prim_ram_1p_pkg::cfg_t ram_cfg = '{
                 cfg_en: ast_ram_1p_cfg.marg_en,
                 cfg:    ast_ram_1p_cfg.marg
-              },
-    rf_cfg:  '{
+              };
+  prim_ram_1p_pkg::cfg_t rf_cfg = '{
                 cfg_en: ast_rf_cfg.marg_en,
                 cfg:    ast_rf_cfg.marg
-              }
+              };
+  // conversion from ast structure to memory centric structures
+  assign ram_1p_cfg = '{
+    ram_cfg: ram_cfg,
+    rf_cfg: rf_cfg
   };
 
-  assign ram_2p_cfg = '{
-    a_ram_fcfg: '{
+  prim_ram_2p_pkg::cfg_t a_ram_fcfg = '{
                    cfg_en: ast_ram_2p_fcfg.marg_en_a,
                    cfg:    ast_ram_2p_fcfg.marg_a
-                 },
-    a_ram_lcfg: '{
+                 };
+  prim_ram_2p_pkg::cfg_t b_ram_fcfg = '{
                    cfg_en: ast_ram_2p_lcfg.marg_en_a,
                    cfg:    ast_ram_2p_lcfg.marg_a
-                 },
-    b_ram_fcfg: '{
+                 };
+  prim_ram_2p_pkg::cfg_t a_ram_lcfg = '{
                    cfg_en: ast_ram_2p_fcfg.marg_en_b,
                    cfg:    ast_ram_2p_fcfg.marg_b
-                 },
-    b_ram_lcfg: '{
+                 };
+  prim_ram_2p_pkg::cfg_t b_ram_lcfg = '{
                    cfg_en: ast_ram_2p_lcfg.marg_en_b,
                    cfg:    ast_ram_2p_lcfg.marg_b
-                 }
+                 };
+  assign ram_2p_cfg = '{
+    a_ram_fcfg: a_ram_fcfg,
+    a_ram_lcfg: a_ram_lcfg,
+    b_ram_fcfg: b_ram_fcfg,
+    b_ram_lcfg: b_ram_lcfg
   };
 
   assign rom_cfg = '{
-- 
2.39.0

